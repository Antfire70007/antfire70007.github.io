<!DOCTYPE html><html lang="zh-TW"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPW76PRVB3"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CPW76PRVB3")</script><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keyword" content=""><meta name="author" content="Antfire"><meta name="description" content="&amp;nbsp;何謂重構(Refactoring)?重構是將一套軟體系統，透過一系列的處理程序，在不改變軟體程式的外在行為的情況下，改動內部架構。重構是透過一套有紀律的方法整理程式碼，並且將在變更程式碼架構的過程中，將產生臭蟲(Bugs)的機率降到最低。 &amp;nbsp;使用範例以下將以以下範例著手進行重構 &amp;nbsp;程式範例&amp;nbsp;演出清單.json&amp;#123;  &quot;hamlet&amp;quo"><meta property="og:type" content="website"><meta property="og:title" content="Refactoring 讀書心得 part 1"><meta property="og:url" content="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/index.html"><meta property="og:site_name" content="Antfire 的生活雜記"><meta property="og:description" content="&amp;nbsp;何謂重構(Refactoring)?重構是將一套軟體系統，透過一系列的處理程序，在不改變軟體程式的外在行為的情況下，改動內部架構。重構是透過一套有紀律的方法整理程式碼，並且將在變更程式碼架構的過程中，將產生臭蟲(Bugs)的機率降到最低。 &amp;nbsp;使用範例以下將以以下範例著手進行重構 &amp;nbsp;程式範例&amp;nbsp;演出清單.json&amp;#123;  &quot;hamlet&amp;quo"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/card_refact2.jpg"><meta property="article:published_time" content="2021-12-09T02:44:47.000Z"><meta property="article:modified_time" content="2025-09-09T00:13:26.822Z"><meta property="article:author" content="Antfire"><meta property="article:tag" content="JavaScript"><meta property="article:tag" content="Refactoring"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/card_refact2.jpg"><meta property="fb:app_id" content="545543353411406"><title>Refactoring 讀書心得 part 1 | Antfire 的生活雜記</title><link rel="shortcut icon" href="/assets/images/favicon.png"><link rel="icon" type="image/png" href="/assets/images/favicon.png"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300i,400,400i,700%7cMarcellus+SC" rel="stylesheet"><link rel="stylesheet" href="/assets/vendor/bootstrap/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/assets/vendor/ionicons/css/ionicons.min.css"><link rel="stylesheet" href="/assets/vendor/revolution/css/settings.css"><link rel="stylesheet" href="/assets/vendor/revolution/css/layers.css"><link rel="stylesheet" href="/assets/vendor/revolution/css/navigation.css"><link rel="stylesheet" href="/assets/vendor/flickity/dist/flickity.min.css"><link rel="stylesheet" href="/assets/vendor/photoswipe/dist/photoswipe.css"><link rel="stylesheet" href="/assets/vendor/photoswipe/dist/default-skin/default-skin.css"><link rel="stylesheet" href="/assets/vendor/jquery-datetimepicker/build/jquery.datetimepicker.min.css"><link rel="stylesheet" href="/assets/vendor/summernote/dist/summernote-bs4.css"><link rel="stylesheet" href="/assets/css/godlike.min.css"><link rel="stylesheet" href="/assets/css/custom.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"><link rel="stylesheet" href="/assets/css/github-dark.css"><script src="/assets/vendor/fontawesome-free/js/all.js"></script><script src="/assets/vendor/fontawesome-free/js/v4-shims.js"></script><script src="/assets/vendor/jquery/dist/jquery.min.js"></script><noscript>您的瀏覽器不支援JavaScript功能，若網頁功能無法正常使用時，請開啟瀏覽器JavaScript狀態</noscript><link rel="alternate" href="/atom.xml" title="Antfire 的生活雜記" type="application/atom+xml">
</head><body><div class="nk-preloader"><div class="nk-preloader-bg" style="background-color:#000" data-close-frames="23" data-close-speed="1.2" data-close-sprites="/assets/images/preloader-bg.png" data-open-frames="23" data-open-speed="1.2" data-open-sprites="/assets/images/preloader-bg-bw.png"></div><div class="nk-preloader-content"><div><img class="nk-img" src="/assets/images/logo-2x-dark-antfire.png" alt="Antfire 的生活雜記" width="78"><div class="nk-preloader-animation"></div></div></div><div class="nk-preloader-skip">Skip</div></div><div class="nk-page-background op-5" data-video="https://www.youtube.com/watch?v=rF53gAnfuU8" data-video-loop="true" data-video-mute="false" data-video-volume="5" data-video-start-time="0" data-video-end-time="0" data-video-pause-on-page-leave="true" style="background-image:url(https://img.youtube.com/vi/rF53gAnfuU8/maxresdefault_live.jpg)"></div><div class="nk-page-background-audio d-none" data-audio="/assets/mp3/purpleplanetmusic-desolation.mp3" data-audio-volume="100" data-audio-autoplay="false" data-audio-loop="true" data-audio-pause-on-page-leave="true"></div><div class="nk-page-border"><div class="nk-page-border-t"></div><div class="nk-page-border-r"></div><div class="nk-page-border-b"></div><div class="nk-page-border-l"></div></div><header class="nk-header nk-header-opaque"><div class="nk-contacts-top"><div class="container"><div class="nk-contacts-left"><div class="nk-navbar"><a href="#AC" id="gotocenter" title="中央主要內容區塊 [快速鍵Alt+C]" tabindex="1" class="sr-only sr-only-focusable" accesskey="C">跳到主要內容</a><ul class="nk-nav"><li class="nk-drop-item"><a href="javascript:void(0)">繁體中文</a><ul class="dropdown"><li><a href="/en">English</a></li></ul></li><li><a href="/privacy">隱私權政策</a></li></ul></div></div></div></div><nav class="nk-navbar nk-navbar-top nk-navbar-sticky nk-navbar-transparent nk-navbar-autohide"><div class="container"><div class="nk-nav-table"><a href="/" class="nk-nav-logo"><img src="/assets/images/logo_logo-2x-dark-antfire.png" alt="Antfire 的生活雜記"></a><ul class="nk-nav nk-nav-right d-none d-lg-block" data-nav-mobile="#nk-nav-mobile"><li><a href="#U" id="AU" name="U" title="右上方功能區塊" accesskey="U" onclick='$(".nk-scroll-top").click()'>:::</a></li><li><a href="/">首頁</a></li><li class="nk-drop-item nk-mega-item"><a href="javascript:void(0)">生活記趣</a><div class="dropdown"><div class="bg-image"><img src="/assets/images/logo_bg01.jpg" alt="bg" class="jarallax-img"></div><ul><li><a href="/categories/Game">遊戲攻略</a></li></ul></div></li><li><a href="/archives">過往文章</a></li></ul><ul class="nk-nav nk-nav-right nk-nav-icons"><li class="single-icon"><a href="#" class="nk-search-toggle no-link-effect" title="站內搜尋"><span class="nk-icon-search"></span> &nbsp;</a></li><li class="single-icon"><a href="#" class="no-link-effect" data-nav-toggle="#nk-side" title="menu">&nbsp; <span class="nk-icon-burger"><span class="nk-t-1"></span> <span class="nk-t-2"></span> <span class="nk-t-3"></span></span></a></li></ul></div></div></nav></header><nav class="nk-navbar nk-navbar-side nk-navbar-right-side nk-navbar-lg nk-navbar-align-center nk-navbar-overlay-content" id="nk-side"><div class="nk-navbar-bg"><div class="bg-image"><img src="/assets/images/bg01.jpg" alt="bg" class="jarallax-img"></div></div><div class="nano"><div class="nano-content"><div class="nk-nav-table"><div class="nk-nav-row"><a href="/" class="nk-nav-logo"><img src="/assets/images/logo-2x-dark-antfire.png" alt="Antfire 的生活雜記"></a></div><div class="nk-nav-row nk-nav-row-full nk-nav-row-center"><ul class="nk-nav"><li><a href="/">首頁</a></li><li class="nk-drop-item"><a href="javascript:void(0)">生活記趣</a><div class="bg-image"><img src="/assets/images/bg02.jpg" alt="bg" class="jarallax-img"></div><ul class="dropdown"><li><a href="/categories/Game">遊戲攻略</a></li></ul></li><li><a href="/archives">過往文章</a></li></ul></div><div class="nk-nav-row"><div class="nk-nav-footer">2023 Antfire, All Rights Reserved.</div></div></div></div></div></nav><div id="nk-nav-mobile" class="nk-navbar nk-navbar-side nk-navbar-left-side nk-navbar-overlay-content d-lg-none"><div class="nano"><div class="nano-content"><a href="/" class="nk-nav-logo"><img src="/assets/images/logo_logo-2x-dark-antfire.png" alt="Antfire 的生活雜記"></a><div class="nk-navbar-mobile-content"><ul class="nk-nav"></ul></div></div></div></div><div class="nk-main" id="maincontent"><div class="nk-breadcrumbs text-center"><div class="container"><ul><li><a href="#">首頁</a></li><li><a href="#">Blog</a></li><li><span>Refactoring 讀書心得 ...</span></li></ul></div></div><div class="nk-header-title nk-header-title-md nk-header-title-parallax nk-header-title-parallax-opacity nk-header-title-boxed"><div class="bg-image op-5"><img src="/blog/study-circle-refactoring-part-1/large_refact2.jpg" alt="banner" class="jarallax-img"></div><div class="nk-header-table" id="AC"><div class="nk-header-table-cell"><div class="container"><div class="nk-header-text"><div class="row text-left"><div class="col-lg-8"><div class="nk-gap-5 d-none d-lg-block"></div><h1 class="nk-title"><span class="nk-typed" data-loop="false" data-shuffle="false" data-cursor="false" data-type-speed="90" data-start-delay="0" data-back-speed="60" data-back-delay="1000"><span>Refactoring 讀書心得 part 1</span></span></h1><div class="nk-gap-3 d-none d-lg-block"></div><div class="nk-gap-5 d-none d-lg-block"></div></div><div class="col-lg-4"><aside class="nk-sidebar nk-sidebar-right"><div class="nk-gap-5 d-none d-lg-block"></div><div class="nk-gap d-lg-none"></div><table><tbody><tr><td><strong>Published:</strong> &nbsp;&nbsp;&nbsp;</td><td>December 9, 2021</td></tr><tr><td><strong>Category:</strong> &nbsp;&nbsp;&nbsp;</td><td><a href="/categories/Study-Circle/">Study Circle</a></td></tr><tr><td><strong>Written by:</strong> &nbsp;&nbsp;&nbsp;</td><td><a href="/aboutme">Antfire</a></td></tr><tr><td><strong>Views:</strong> &nbsp;&nbsp;&nbsp;</td><td><span id="busuanzi_value_page_pv"></span></td></tr><tr><td><strong>Comments:</strong> &nbsp;&nbsp;&nbsp;</td><td><fb:comments-count href="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/"></fb:comments-count></td></tr><tr><td><strong>Likes:</strong> &nbsp;&nbsp;</td><td><span class="nk-action-heart"><span class="num nk-liker-counter" data-liker-user-id="antfire70007>" data-liker-url="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/">0</span> <span class="like-icon ion-android-favorite-outline"></span> <span class="liked-icon ion-android-favorite"></span></span></td></tr></tbody></table><div class="nk-gap-5 d-lg-none"></div></aside></div></div></div></div></div></div></div><div class="container"><div class="row"><div class="col-lg-8"><div class="nk-blog-container nk-blog-container-offset"><div class="nk-blog-post nk-blog-post-single"><div><img src="/blog/study-circle-refactoring-part-1/refact2.jpg" alt="Refactoring 讀書心得 part 1" style="width:100%" class="jarallax-img"></div><div class="nk-post-text mt-0"><h1 id="何謂重構-Refactoring"><a href="#何謂重構-Refactoring" class="headerlink" title="何謂重構(Refactoring)?" style="display:none">&nbsp;</a>何謂重構(Refactoring)?</h1><p>重構是將一套軟體系統，透過一系列的處理程序，在不改變軟體程式的外在行為的情況下，改動內部架構。<br>重構是透過一套有紀律的方法整理程式碼，並且將在變更程式碼架構的過程中，將產生臭蟲(Bugs)的機率降到最低。</p><h1 id="使用範例"><a href="#使用範例" class="headerlink" title="使用範例" style="display:none">&nbsp;</a>使用範例</h1><p>以下將以以下範例著手進行重構</p><h2 id="程式範例"><a href="#程式範例" class="headerlink" title="程式範例" style="display:none">&nbsp;</a>程式範例</h2><h3 id="演出清單-json"><a href="#演出清單-json" class="headerlink" title="演出清單.json" style="display:none">&nbsp;</a>演出清單.json</h3><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>
 <span class="hljs-attr">&quot;hamlet&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Hamlet&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tragedy&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">&quot;as-like&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;As You Like It&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;comedy&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">&quot;othello&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Othello&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tragedy&quot;</span><span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">&#125;</span></code></pre><h3 id="帳單清單-json"><a href="#帳單清單-json" class="headerlink" title="帳單清單.json" style="display:none">&nbsp;</a>帳單清單.json</h3><pre><code class="hljs json"><span class="hljs-punctuation">[</span>
 <span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">&quot;customer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;BigCo&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;performances&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
  	<span class="hljs-punctuation">&#123;</span>
	  <span class="hljs-attr">&quot;playID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;halmet&quot;</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">&quot;audience&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">55</span>
	<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
	<span class="hljs-punctuation">&#123;</span>
	  <span class="hljs-attr">&quot;playID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;as-like&quot;</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">&quot;audience&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">35</span>
	<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
	<span class="hljs-punctuation">&#123;</span>
	  <span class="hljs-attr">&quot;playID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;othello&quot;</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">&quot;audience&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">40</span>
	<span class="hljs-punctuation">&#125;</span>
  <span class="hljs-punctuation">]</span>
 <span class="hljs-punctuation">&#125;</span>
<span class="hljs-punctuation">]</span></code></pre><h3 id="列印帳單程式碼"><a href="#列印帳單程式碼" class="headerlink" title="列印帳單程式碼" style="display:none">&nbsp;</a>列印帳單程式碼</h3><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    <span class="hljs-keyword">const</span> play = plays[perf.<span class="hljs-property">playID</span>];
	<span class="hljs-keyword">let</span> thisAmount = <span class="hljs-number">0</span>;
	
	<span class="hljs-keyword">switch</span> (play.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  thisAmount = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    thisAmount += <span class="hljs-number">1000</span> * (perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  thisAmount = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    thisAmount += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (perf.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  thisAmount += <span class="hljs-number">300</span> * perf.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;play.type&#125;</span>`</span>);
	&#125;
	
	<span class="hljs-comment">// add volume credits</span>
	volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	<span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === play.<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;play.name&#125;</span>: <span class="hljs-subst">$&#123;format(thisAmount/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += thisAmount;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(totalAmount/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>以上程式輸出結果為</p><pre><code class="hljs bash">State <span class="hljs-keyword">for</span> BigCo
  Hamlet: <span class="hljs-variable">$650</span>.00 (55 seats)
  As You Like It: <span class="hljs-variable">$580</span>.00 (35 seats)
  Othello: <span class="hljs-variable">$500</span>.00 (40 seats)
Amount owed is <span class="hljs-variable">$1</span>,730.00
You earned 47 credits</code></pre><h1 id="重構前置作業"><a href="#重構前置作業" class="headerlink" title="重構前置作業" style="display:none">&nbsp;</a>重構前置作業</h1><p>在著手進行任何重構作業前，必須要先確保有一套自我檢測的機制，確保重構後的功能可以正常運作。<br>即使依照重構的標準作業心法，亦有可能會產生臭蟲，畢竟人都會犯錯。因此，有一套檢測機制例如單元測試等，可以測試功能的正確性，是一件很重要的事情。</p><h1 id="重構起手式-增加程式碼可讀性"><a href="#重構起手式-增加程式碼可讀性" class="headerlink" title="重構起手式 - 增加程式碼可讀性" style="display:none">&nbsp;</a>重構起手式 - 增加程式碼可讀性</h1><p>以上面的<code>statement</code>的函式為例，要進行重構像這樣的函式，第一眼看到的是for迴圈中的<code>switch</code>區塊，剛寫完腦袋或許還會記得這一段程式碼的用途，但過了一段時間再回來看，可能需要花一點時間回想一下才想得起來。因此，將這一段程式碼單獨拆出來一個函式，並且用有意義的命名方式為此函式命名<code>amountFor</code></p><h2 id="分解函式statement"><a href="#分解函式statement" class="headerlink" title="分解函式statement" style="display:none">&nbsp;</a>分解函式<code>statement</code></h2><blockquote><p>心法: Extract Function</p></blockquote><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">perf, play</span>)&#123;
    <span class="hljs-keyword">let</span> thisAmount = <span class="hljs-number">0</span>;
	
	<span class="hljs-keyword">switch</span> (play.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  thisAmount = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    thisAmount += <span class="hljs-number">1000</span> * (perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  thisAmount = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    thisAmount += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (perf.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  thisAmount += <span class="hljs-number">300</span> * perf.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;play.type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> thisAmount;
  &#125;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    <span class="hljs-keyword">const</span> play = plays[perf.<span class="hljs-property">playID</span>];
	<span class="hljs-keyword">let</span> thisAmount = <span class="hljs-title function_">amountFor</span>(perf, play);
	
	
	<span class="hljs-comment">// add volume credits</span>
	volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	<span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === play.<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;play.name&#125;</span>: <span class="hljs-subst">$&#123;format(thisAmount/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += thisAmount;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(totalAmount/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><blockquote><p>Refactoring changes the programs in small steps, so if you make a mistake, it is easy to find where the bug is.</p></blockquote><h2 id="區域變數有意義化"><a href="#區域變數有意義化" class="headerlink" title="區域變數有意義化" style="display:none">&nbsp;</a>區域變數有意義化</h2><p>把函式抽取出來後，接下來整理一下抽取出來後的函式中的區域變數，將其重新命名使它更清楚明瞭，以上面的例子為例，將<code>thisAmount</code>更名為<code>result</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">perf, play</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	
	<span class="hljs-keyword">switch</span> (play.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (perf.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * perf.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;play.type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;</code></pre><blockquote><p>Any fool can write code that a computer can understand.<br>Good programmers write code that humans can understand.</p></blockquote><h3 id="將第一個參數perf重新命名"><a href="#將第一個參數perf重新命名" class="headerlink" title="將第一個參數perf重新命名" style="display:none">&nbsp;</a>將第一個參數<code>perf</code>重新命名</h3><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance, play</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	
	<span class="hljs-keyword">switch</span> (play.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;play.type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;</code></pre><p>此命名方式包含了參數的型別及參數名稱 [type][ParameterName]，這個命名方式是筆者從Kent Beck學習來的。</p><h3 id="移除play變數"><a href="#移除play變數" class="headerlink" title="移除play變數" style="display:none">&nbsp;</a>移除<code>play</code>變數</h3><blockquote><p>心法：Replace Temp with Query</p></blockquote><h4 id="套用心法Replace-Temp-with-Query"><a href="#套用心法Replace-Temp-with-Query" class="headerlink" title="套用心法Replace Temp with Query" style="display:none">&nbsp;</a>套用心法<code>Replace Temp with Query</code></h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">return</span> plays[aPerformance.<span class="hljs-property">playID</span>];
  &#125;
&#125;</code></pre><p>程式主體變成如下</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    <span class="hljs-keyword">const</span> play = <span class="hljs-title function_">playFor</span>(perf);
	<span class="hljs-keyword">let</span> thisAmount = <span class="hljs-title function_">amountFor</span>(perf, play);
	
	
	<span class="hljs-comment">// add volume credits</span>
	volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	<span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === play.<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;play.name&#125;</span>: <span class="hljs-subst">$&#123;format(thisAmount/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += thisAmount;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(totalAmount/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>接著測試沒問題的話，可以開始消滅變數<code>play</code>了</p><blockquote><p>心法： Inline Variable</p></blockquote><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    <span class="hljs-comment">//const play = playFor(perf);</span>
	<span class="hljs-keyword">let</span> thisAmount = <span class="hljs-title function_">amountFor</span>(perf, <span class="hljs-title function_">playFor</span>(perf));
	
	
	<span class="hljs-comment">// add volume credits</span>
	volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	<span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(perf).<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;format(thisAmount/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += thisAmount;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(totalAmount/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>接著是函式<code>amountFor</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance, play</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	
	<span class="hljs-keyword">switch</span> (<span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;playFor(aPerformance).type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;</code></pre><blockquote><p>心法：Change Function Declaration</p></blockquote><p>因為已經將play套用了心法 <code>Inline Variable</code><br>因此可以套用心法<code>Change Function Declaration</code>將<code>play</code>參數移除</p><p>先修改<code>statement</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    <span class="hljs-comment">//const play = playFor(perf);</span>
	<span class="hljs-keyword">let</span> thisAmount = <span class="hljs-title function_">amountFor</span>(perf);
	
	
	<span class="hljs-comment">// add volume credits</span>
	volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	<span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(perf).<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;format(thisAmount/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += thisAmount;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(totalAmount/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>接著修改<code>amountFor</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	
	<span class="hljs-keyword">switch</span> (<span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;playFor(aPerformance).type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;</code></pre><p>接著繼續消除區域變數<code>thisAmount</code><br>套用心法：<code>Inline Variable</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    <span class="hljs-comment">//const play = playFor(perf);</span>
	<span class="hljs-comment">//let thisAmount = amountFor(perf);</span>
	
	<span class="hljs-comment">// add volume credits</span>
	volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	<span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(perf).<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;format(amountFor(perf)/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(amountFor(perf)/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h4 id="抽出-Volumn-Credits變成函式"><a href="#抽出-Volumn-Credits變成函式" class="headerlink" title="抽出 Volumn Credits變成函式" style="display:none">&nbsp;</a>抽出 <code>Volumn Credits</code>變成函式</h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">perf</span>)&#123;
      <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
	  volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	  <span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(perf).<span class="hljs-property">type</span>) volumeCredits += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	  <span class="hljs-keyword">return</span> volumeCredits;
	&#125;</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">const</span> format = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-property">format</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	volumeCredits += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;format(amountFor(perf)/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(amountFor(perf)/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>重新定義參數名稱</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	  <span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(aPerformance.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	  <span class="hljs-keyword">return</span> result;
	&#125;</code></pre><h4 id="移除變數format"><a href="#移除變數format" class="headerlink" title="移除變數format" style="display:none">&nbsp;</a>移除變數<code>format</code></h4><p>我們先把format的RHS取代成呼叫函式<code>format</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">aNumber</span>)&#123;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
  						&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
						  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-title function_">format</span>(aNumber);
	&#125;</code></pre><p>調整<code>statement</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	volumeCredits += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;format(amountFor(perf)/<span class="hljs-number">100</span>)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;format(totalAmount/<span class="hljs-number">100</span>)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>調整完後，會發現format在閱讀上不是很直觀，到底是格式化成什麼呢？<br>因此，再套用一下心法<code>Change Function Declaration</code>讓它變得更容易閱讀一些。<br>變更函式<code>format</code>名稱為<code>usd</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
		&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
		  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-title function_">format</span>(aNumber/<span class="hljs-number">100</span>);
	&#125;</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	volumeCredits += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h4 id="移除變數volumeCredits"><a href="#移除變數volumeCredits" class="headerlink" title="移除變數volumeCredits" style="display:none">&nbsp;</a>移除變數<code>volumeCredits</code></h4><p>接下來是移除區域變數<code>volumnCredits</code>，可以看到<code>for</code>迴圈中，做了兩件不同的事情，第一是計算總票數；第二是列印訂單，因此，套用心法：<code>Split Loop</code>，將迴圈裡做的事情拆開。</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	volumeCredits += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
  &#125;
  
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>下一步是套用心法：<code>Slide Statements</code>，將相關的變數宣告，例如：<code>volumeCredits</code>移到<code>for</code>迴圈旁邊。</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	volumeCredits += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
  &#125;
  
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>再來就是跟之前的步驟一樣，先套用心法：<code>Extract Function</code>再套用心法：<code>Replace Temp with Query</code><br>擷取函式(Extract Function)</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-number">0</span>;  
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
		volumeCredits += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> volumeCredits;
	&#125;</code></pre><p>Replace Temp with Query</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  <span class="hljs-keyword">let</span> volumeCredits = <span class="hljs-title function_">totalVolumeCredits</span>();  
  
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;volumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>再來套用<code>Inline Variable</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
	totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h3 id="總結以上步驟"><a href="#總結以上步驟" class="headerlink" title="總結以上步驟" style="display:none">&nbsp;</a>總結以上步驟</h3><p>再拆解迴圈的時候，可能會有效能問題，因為原本一個迴圈可以做很多事情，拆完之後變成一個迴圈分別做一件事情。<br>作者的建議是先做完重構這件事情之後，再來做效能調教。</p><p>以拆解<code>volumeCredits</code>變數為例，拆解的流程如下</p><ul><li>Split Loop</li><li>Slide Statements</li><li>Extract Function</li><li>Inline Variable</li></ul><p>接著以同樣的步驟再來移除變數<code>totalAmount</code></p><h3 id="移除變數totalAmount"><a href="#移除變數totalAmount" class="headerlink" title="移除變數totalAmount" style="display:none">&nbsp;</a>移除變數<code>totalAmount</code></h3><h4 id="套用心法：Split-Loop"><a href="#套用心法：Split-Loop" class="headerlink" title="套用心法：Split Loop" style="display:none">&nbsp;</a>套用心法：<code>Split Loop</code></h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h4 id="套用心法：Slide-Statements"><a href="#套用心法：Slide-Statements" class="headerlink" title="套用心法：Slide Statements" style="display:none">&nbsp;</a>套用心法：<code>Slide Statements</code></h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
    totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h4 id="套用心法：Extract-Function"><a href="#套用心法：Extract-Function" class="headerlink" title="套用心法：Extract Function" style="display:none">&nbsp;</a>套用心法：<code>Extract Function</code></h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">appleSauce</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-number">0</span>;
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
		totalAmount += <span class="hljs-title function_">amountFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> totalAmount;
	&#125;</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  <span class="hljs-keyword">let</span> totalAmount = <span class="hljs-title function_">appleSauce</span>();
  
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h4 id="套用心法：Inline-Variable"><a href="#套用心法：Inline-Variable" class="headerlink" title="套用心法：Inline Variable" style="display:none">&nbsp;</a>套用心法：<code>Inline Variable</code></h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(appleSauce())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><p>最後是重新命名函式名稱和區域變數名稱</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">amountFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
	&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;  
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
	&#125;</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
  
	<span class="hljs-comment">// print line for this order</span>
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;</code></pre><h3 id="目前重構的狀態"><a href="#目前重構的狀態" class="headerlink" title="目前重構的狀態" style="display:none">&nbsp;</a>目前重構的狀態</h3><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">amountFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;  
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;	
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
		&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
		  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-title function_">format</span>(aNumber/<span class="hljs-number">100</span>);
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	  <span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(aPerformance.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	  <span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">return</span> plays[aPerformance.<span class="hljs-property">playID</span>];
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">switch</span> (<span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;playFor(aPerformance).type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;</code></pre><h3 id="將程式拆成計算及格式化輸出"><a href="#將程式拆成計算及格式化輸出" class="headerlink" title="將程式拆成計算及格式化輸出" style="display:none">&nbsp;</a>將程式拆成計算及格式化輸出</h3><p>在這邊會用到心法：<code>Split Phase</code>來達到將計算跟格式化兩個工作分開</p><p>先套用心法：<code>Extract Function</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(invoice, plays);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
&#125;</code></pre><p>接著建立一個物件扮演計算及格式化輸出兩個工作的中介資料</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(statementData, invoice, plays);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">data, invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;invoice.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
&#125;</code></pre><p>下一步是將<code>renderPlainText</code>中會用到的其他參數搬到新增的<code>data</code>物件參數中<br>首先是 <code>invoice</code></p><h5 id="搬移invoice參數到data"><a href="#搬移invoice參數到data" class="headerlink" title="搬移invoice參數到data" style="display:none">&nbsp;</a>搬移<code>invoice</code>參數到<code>data</code></h5><p>變化過程如下</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  statementData.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(statementData, invoice, plays);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">data, invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> invoice.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
&#125;</code></pre><p>接著</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  statementData.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  statementData.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(statementData, invoice, plays);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">data, invoice, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">amountFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;  
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;	
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
&#125;</code></pre><p>確認都搬完了，就可以將參數<code>invoice</code>移除</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  statementData.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  statementData.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(statementData,  plays);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">data, plays</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;playFor(perf).name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">amountFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;  
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
		result += <span class="hljs-title function_">volumeCreditsFor</span>(perf);
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;	
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
&#125;</code></pre><p>接著將<code>renderPlainText</code>中的<code>playFor(perf).name</code>抽出來，放到中介資料<code>statementData</code>的<code>name</code>屬性</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  statementData.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  statementData.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>.<span class="hljs-title function_">map</span>(enrichPerformance);
  
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(statementData,  plays);
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">enrichPerformance</span>(<span class="hljs-params">aPerformance</span>) &#123;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, aPerformance);
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;

</code></pre><p>因為<code>playFor</code>未來也只有在特定的函式中用到，因此，套用心法：<code>Move Function</code>，將<code>playFor</code>函式移回到<code>statement</code>函式中。</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">enrichPerformance</span>(<span class="hljs-params">aPerformance</span>) &#123;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, aPerformance);
	result.<span class="hljs-property">play</span> = <span class="hljs-title function_">playFor</span>(result);
	<span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">return</span> plays[aPerformance.<span class="hljs-property">playID</span>];
  &#125;
&#125;
</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> renderPlainText...
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;perf.play.name&#125;</span>: <span class="hljs-subst">$&#123;usd(amountFor(perf))&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">perf</span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(perf.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	  <span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === perf.<span class="hljs-property">play</span>.<span class="hljs-property">type</span>) result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(perf.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	  <span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">switch</span> (aPerformance.<span class="hljs-property">play</span>.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;aPerformance.play.type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
&#125;</code></pre><p><code>amountFor</code>也使用同樣的方式</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">enrichPerformance</span>(<span class="hljs-params">aPerformance</span>) &#123;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, aPerformance);
	result.<span class="hljs-property">play</span> = <span class="hljs-title function_">playFor</span>(result);
	result.<span class="hljs-property">amount</span> = <span class="hljs-title function_">amountFor</span>(result);
	<span class="hljs-keyword">return</span> result;
  &#125;
  
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;... &#125;
&#125;
</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> renderPlainText...
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;perf.play.name&#125;</span>: <span class="hljs-subst">$&#123;usd(perf.amount)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(totalAmount())&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;totalVolumeCredits()&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
		result += perf.<span class="hljs-property">amount</span>;
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;</code></pre><p>還有<code>volumeCreditsFor</code></p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> statement...
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">enrichPerformance</span>(<span class="hljs-params">aPerformance</span>) &#123;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, aPerformance);
	result.<span class="hljs-property">play</span> = <span class="hljs-title function_">playFor</span>(result);
	result.<span class="hljs-property">amount</span> = <span class="hljs-title function_">amountFor</span>(result);
	result.<span class="hljs-property">volumeCredits</span> = <span class="hljs-title function_">volumeCreditsFor</span>(result);
	<span class="hljs-keyword">return</span> result;
  &#125;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;...&#125;
&#125;
</code></pre><pre><code class="hljs javascript">
<span class="hljs-keyword">function</span> renderPlainText...
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params"></span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;  
	  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
		result += perf.<span class="hljs-property">volumeCredits</span>;
	  &#125;
	  <span class="hljs-keyword">return</span> result;
  &#125;	
&#125;</code></pre><p>確認現階段程式運作正常後，繼續下一步，將函式<code>totalVolumeCredits</code>套用<code>Move Function</code>心法，將函式<code>totalVolumeCredits</code>從函式<code>renderPlainText</code>底下，移回函式<code>statement</code></p><p>函式<code>totalAmount</code>也是一樣的作法</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  statementData.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  statementData.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>.<span class="hljs-title function_">map</span>(enrichPerformance);
  statementData.<span class="hljs-property">totalAmount</span> = <span class="hljs-title function_">totalAmount</span>(statementData);
  statementData.<span class="hljs-property">totalVolumeCredits</span> = <span class="hljs-title function_">totalVolumeCredits</span>(statementData);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(statementData,  plays)
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params">data</span>)&#123;...&#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params">data</span>)&#123;...&#125;
&#125;
</code></pre><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> renderPlainText...
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;perf.play.name&#125;</span>: <span class="hljs-subst">$&#123;usd(perf.amount)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(data.totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;data.totalVolumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;</code></pre><h4 id="從函式statement中擷取函式"><a href="#從函式statement中擷取函式" class="headerlink" title="從函式statement中擷取函式" style="display:none">&nbsp;</a>從函式<code>statement</code>中擷取函式</h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-title function_">createStatementData</span>(statementData,  plays)	);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createStatementData</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> statementData = &#123;&#125;;
  statementData.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  statementData.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>.<span class="hljs-title function_">map</span>(enrichPerformance);
  statementData.<span class="hljs-property">totalAmount</span> = <span class="hljs-title function_">totalAmount</span>(statementData);
  statementData.<span class="hljs-property">totalVolumeCredits</span> = <span class="hljs-title function_">totalVolumeCredits</span>(statementData);
  
  <span class="hljs-keyword">return</span> statementData;
 
&#125;</code></pre><h4 id="為區域變數重新命名"><a href="#為區域變數重新命名" class="headerlink" title="為區域變數重新命名" style="display:none">&nbsp;</a>為區域變數重新命名</h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-title function_">createStatementData</span>(statementData,  plays)	);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createStatementData</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> result = &#123;&#125;;
  result.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  result.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>.<span class="hljs-title function_">map</span>(enrichPerformance);
  result.<span class="hljs-property">totalAmount</span> = <span class="hljs-title function_">totalAmount</span>(statementData);
  result.<span class="hljs-property">totalVolumeCredits</span> = <span class="hljs-title function_">totalVolumeCredits</span>(statementData);
  
  <span class="hljs-keyword">return</span> result;
 
&#125;</code></pre><h4 id="套用心法：Replace-Loop-with-Pipeline"><a href="#套用心法：Replace-Loop-with-Pipeline" class="headerlink" title="套用心法：Replace Loop with Pipeline" style="display:none">&nbsp;</a>套用心法：<code>Replace Loop with Pipeline</code></h4><p>將有使用到迴圈的程式碼，改寫成使用pipeline</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> renderPlainText...
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params">data</span>) &#123;
    <span class="hljs-keyword">return</span> data.<span class="hljs-property">performances</span>
	  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">total,p</span>) =&gt;</span> total + p.<span class="hljs-property">amount</span>, <span class="hljs-number">0</span>);
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params">data</span>) &#123;
    <span class="hljs-keyword">return</span> data.<span class="hljs-property">performances</span>
	  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">total, p</span>) =&gt;</span> total + p.<span class="hljs-property">volumeCredits</span>, <span class="hljs-number">0</span>);
  &#125;</code></pre><h3 id="目前狀態"><a href="#目前狀態" class="headerlink" title="目前狀態" style="display:none">&nbsp;</a>目前狀態</h3><p>現在已經整理到一個階段了，可以將程式碼分成兩個檔案，一個是創建對帳單(<code>createStatementData.js</code>)，一個是呈現對帳單(<code>statement.js</code>)</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-title function_">createStatementData</span>(statementData,  plays));
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">data</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;perf.play.name&#125;</span>: <span class="hljs-subst">$&#123;usd(perf.amount)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(data.totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;data.totalVolumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
	&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
	  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-title function_">format</span>(aNumber/<span class="hljs-number">100</span>);
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createStatementData</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> result = &#123;&#125;;
  result.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  result.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>.<span class="hljs-title function_">map</span>(enrichPerformance);
  result.<span class="hljs-property">totalAmount</span> = <span class="hljs-title function_">totalAmount</span>(statementData);
  result.<span class="hljs-property">totalVolumeCredits</span> = <span class="hljs-title function_">totalVolumeCredits</span>(statementData);
  
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">enrichPerformance</span>(<span class="hljs-params">aPerformance</span>) &#123;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, aPerformance);
	result.<span class="hljs-property">play</span> = <span class="hljs-title function_">playFor</span>(result);
	result.<span class="hljs-property">amount</span> = <span class="hljs-title function_">amountFor</span>(result);
	result.<span class="hljs-property">volumeCredits</span> = <span class="hljs-title function_">volumeCreditsFor</span>(result);
	<span class="hljs-keyword">return</span> result;
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">return</span> plays[aPerformance.<span class="hljs-property">playID</span>];
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">switch</span> (aPerformance.<span class="hljs-property">play</span>.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;aPerformance.play.type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	  <span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(aPerformance.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	  <span class="hljs-keyword">return</span> result;
	&#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params">data</span>)&#123;
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">performances</span>
	  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">total,p</span>) =&gt;</span> total + p.<span class="hljs-property">amount</span>, <span class="hljs-number">0</span>);
  &#125;
 
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params">data</span>)&#123;
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">performances</span>
	  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">total,p</span>) =&gt;</span> total + p.<span class="hljs-property">volumeCredits</span>, <span class="hljs-number">0</span>);
  &#125;	
&#125;</code></pre><p>拆開後結果如下</p><h4 id="createStatementData-js"><a href="#createStatementData-js" class="headerlink" title="createStatementData.js" style="display:none">&nbsp;</a>createStatementData.js</h4><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createStatementData</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">const</span> result = &#123;&#125;;
  result.<span class="hljs-property">customer</span> = invoice.<span class="hljs-property">customer</span>;
  result.<span class="hljs-property">performances</span> = invoice.<span class="hljs-property">performances</span>.<span class="hljs-title function_">map</span>(enrichPerformance);
  result.<span class="hljs-property">totalAmount</span> = <span class="hljs-title function_">totalAmount</span>(statementData);
  result.<span class="hljs-property">totalVolumeCredits</span> = <span class="hljs-title function_">totalVolumeCredits</span>(statementData);
  
  <span class="hljs-keyword">return</span> result;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">enrichPerformance</span>(<span class="hljs-params">aPerformance</span>) &#123;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, aPerformance);
	result.<span class="hljs-property">play</span> = <span class="hljs-title function_">playFor</span>(result);
	result.<span class="hljs-property">amount</span> = <span class="hljs-title function_">amountFor</span>(result);
	result.<span class="hljs-property">volumeCredits</span> = <span class="hljs-title function_">volumeCreditsFor</span>(result);
	<span class="hljs-keyword">return</span> result;
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">playFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">return</span> plays[aPerformance.<span class="hljs-property">playID</span>];
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">amountFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">switch</span> (aPerformance.<span class="hljs-property">play</span>.<span class="hljs-property">type</span>) &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;tragedy&quot;</span>:
	  result = <span class="hljs-number">40000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">30</span>) &#123;
	    result += <span class="hljs-number">1000</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>);
	  &#125;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;comedy&quot;</span>:
	  result = <span class="hljs-number">30000</span>;
	  <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">audience</span> &gt; <span class="hljs-number">20</span>) &#123;
	    result += <span class="hljs-number">10000</span> + <span class="hljs-number">500</span> * (aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">20</span>);
	  &#125;
	  result += <span class="hljs-number">300</span> * aPerformance.<span class="hljs-property">audience</span>;
	  <span class="hljs-keyword">break</span>;
	<span class="hljs-attr">default</span>:
	  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`unknown type: <span class="hljs-subst">$&#123;aPerformance.play.type&#125;</span>`</span>);
	&#125;
	<span class="hljs-keyword">return</span> result;
  &#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">volumeCreditsFor</span>(<span class="hljs-params">aPerformance</span>)&#123;
      <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
	  result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(aPerformance.<span class="hljs-property">audience</span> - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
	  <span class="hljs-comment">// add extra credit for every ten comedy attendees</span>
	  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;comedy&quot;</span> === <span class="hljs-title function_">playFor</span>(aPerformance).<span class="hljs-property">type</span>) result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(aPerformance.<span class="hljs-property">audience</span> / <span class="hljs-number">5</span>);
	  <span class="hljs-keyword">return</span> result;
	&#125;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalAmount</span>(<span class="hljs-params">data</span>)&#123;
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">performances</span>
	  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">total,p</span>) =&gt;</span> total + p.<span class="hljs-property">amount</span>, <span class="hljs-number">0</span>);
  &#125;
 
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalVolumeCredits</span>(<span class="hljs-params">data</span>)&#123;
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">performances</span>
	  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">total,p</span>) =&gt;</span> total + p.<span class="hljs-property">volumeCredits</span>, <span class="hljs-number">0</span>);
  &#125;	
&#125;</code></pre><h4 id="statement-js"><a href="#statement-js" class="headerlink" title="statement.js" style="display:none">&nbsp;</a>statement.js</h4><p>順便新增了 HTML 版本的輸出</p><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">statement</span> (<span class="hljs-params">invoice, plays</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-title function_">createStatementData</span>(statementData,  plays));
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPlainText</span>(<span class="hljs-params">data</span>) &#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>\n`</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
	result += <span class="hljs-string">`  <span class="hljs-subst">$&#123;perf.play.name&#125;</span>: <span class="hljs-subst">$&#123;usd(perf.amount)&#125;</span> (<span class="hljs-subst">$&#123;perf.audience&#125;</span> seats)\n`</span>;
  &#125;
  result += <span class="hljs-string">`Amount owed is <span class="hljs-subst">$&#123;usd(data.totalAmount)&#125;</span>\n`</span>;
  result += <span class="hljs-string">`You earned <span class="hljs-subst">$&#123;data.totalVolumeCredits&#125;</span> credits\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">htmlStatement</span> (<span class="hljs-params">invoice, plays</span>) &#123;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderHtml</span>(<span class="hljs-title function_">createStatementData</span>(invoice, plays));
&#125;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderHtml</span> (<span class="hljs-params">data</span>)&#123;
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">`&lt;h1&gt;Statement for <span class="hljs-subst">$&#123;data.customer&#125;</span>&lt;/h1&gt;\n`</span>;
  result += <span class="hljs-string">&quot;&lt;table&gt;\n&quot;</span>;
  result += <span class="hljs-string">&quot;&lt;tr&gt;&lt;th&gt;play&lt;/th&gt;&lt;th&gt;seats&lt;/th&gt;&lt;th&gt;cost&lt;/th&gt;&lt;/tr&gt;&quot;</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> perf <span class="hljs-keyword">of</span> data.<span class="hljs-property">performances</span>) &#123;
    result += <span class="hljs-string">`  &lt;tr&gt;&lt;td&gt;<span class="hljs-subst">$&#123;perf.play.name&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="hljs-subst">$&#123;perf.audience&#125;</span>&lt;/td&gt;`</span>;
	result +=<span class="hljs-string">`&lt;td&gt;<span class="hljs-subst">$&#123;usd(perf.amount)&#125;</span>&lt;/td&gt;&lt;/tr&gt;\n`</span>;
  &#125;
  result += <span class="hljs-string">&quot;&lt;/table&gt;\n&quot;</span>;
  result += <span class="hljs-string">`&lt;p&gt;Amount owed is &lt;em&gt;<span class="hljs-subst">$&#123;usd(data.totalAmount)&#125;</span>&lt;/em&gt;&lt;/p&gt;\n`</span>;
  result += <span class="hljs-string">`&lt;p&gt;You earned &lt;em&gt;<span class="hljs-subst">$&#123;data.totalVolumeCredits&#125;</span>&lt;/em&gt; credits&lt;/p&gt;\n`</span>;
  <span class="hljs-keyword">return</span> result;
&#125;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">usd</span>(<span class="hljs-params">aNumber</span>)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">&quot;en-US&quot;</span>,
	&#123; <span class="hljs-attr">style</span>: <span class="hljs-string">&quot;currency&quot;</span>, <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
	  <span class="hljs-attr">minimumFractionDigits</span>: <span class="hljs-number">2</span>&#125;).<span class="hljs-title function_">format</span>(aNumber/<span class="hljs-number">100</span>);
&#125;</code></pre><blockquote><p>When programming, follow the camping rule: Always leave the code base healthier than when you found it.</p></blockquote><h1 id="總結"><a href="#總結" class="headerlink" title="總結" style="display:none">&nbsp;</a>總結</h1><p>藉由Split Loop、Slide Statements、Extract Function、Inline Variable、Move Function、Replace Temp with Query、Split Phase、Replace Loop with Pipeline<br>我們將原本耦合度高、程式碼不易閱讀的程式碼，初步變成容易擴充、摸組化的程式碼，並且容易閱讀的兩支js程式。</p><p>接下來，這本書的作者會慢慢把這支程式，轉變成物件導向(Object-oriented)的風格，study-circle part 1 到此結束。</p><h1 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻" style="display:none">&nbsp;</a>參考文獻</h1><ul><li><a target="_blank" rel="noopener" href="https://martinfowler.com/books/refactoring.html">Refactoring - Martin Fowler</a></li><li><a href="/blog/study-circle-refactoring-appendix-split-loop/" title="重構心法之迴圈切割術(Split Loop)">title-重構心法之迴圈切割術(Split Loop)</a></li><li><a href="/blog/study-circle-refactoring-appendix-extract-function/" title="重構心法之函式擷取術(Extract Function)">title-重構心法之函式擷取術(Extract Function)</a></li></ul><div class="nk-post-tags">Tags: &nbsp; <a class="tag-link" href="/tags/JavaScript/" rel="tag">JavaScript</a><a class="tag-link" href="/tags/Refactoring/" rel="tag">Refactoring</a></div><div class="nk-post-tags"><iframe title="liker" scrolling="no" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" style="height:212px;width:100%" src="https://button.like.co/in/embed/antfire70007/button?referrer=https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/"></iframe></div></div><div class="nk-comments" id="comments"><h3 class="nk-title h4 text-center"><fb:comments-count href="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/"></fb:comments-count>&nbsp;Comments</h3><div class="nk-gap-2"></div><div class="fb-comments" style="background:#fff" data-width="100%" data-href="https://www.antfiretoolbox.app/blog/study-circle-refactoring-part-1/" data-numposts="5" data-colorscheme="dark"></div></div></div><div class="nk-gap-4"></div><div class="nk-pagination"><a href="/blog/study-circle-refactoring-appendix-split-loop/" class="nk-pagination-prev" title="重構心法之迴圈切割術(Split Loop)"><span style="line-height:35px" class="d-none d-sm-block">重構心法之迴圈切割術(Split Loop)</span> <span class="nk-icon-arrow-left">&nbsp;</span> </a><a href="/blog/hexo-basic/" class="nk-pagination-next" title="Hexo 基本操作"><span style="line-height:35px" class="d-none d-sm-block">Hexo 基本操作</span> <span class="nk-icon-arrow-right">&nbsp;</span></a></div></div></div><div class="col-lg-4"><aside class="nk-sidebar nk-sidebar-right nk-sidebar-sticky"><div class="nk-gap-4"></div><div class="nk-widget"><h4 class="nk-widget-title">站內搜尋</h4><div><form action="/search/" class="nk-form nk-form-style-1" novalidate><div class="input-group"><input type="text" name="terms" class="form-control" autocomplete="off" placeholder="Type something..." title="Terms"> <button class="nk-btn nk-btn-lg link-effect-4" value="post">&nbsp<span class="ion-search"></span></button></div></form></div></div><div class="nk-widget"><h4 class="nk-widget-title">近期文章</h4><div><div class="nk-widget-post"><a href="/blog/unity-missing-default-layout/" class="nk-image-box-1 nk-post-image" title="Unity 專案打不開？Missing Default Layout 的完整修復指南"><img src="/blog/unity-missing-default-layout/recent_banner.png" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">Unity 專案打不開？Missi...</h3><div class="nk-post-meta-date">September 9, 2025</div></div><div class="nk-widget-post"><a href="/blog/solution-for-generate-error-for-duplicate-files-in-publish-output-when-publishing-website-in-visual-studio/" class="nk-image-box-1 nk-post-image" title="Visual Studio 發布網站常見錯誤：[找到多個具有相同相對路徑的發佈輸出檔案] 解法一次看懂！"><img src="/blog/solution-for-generate-error-for-duplicate-files-in-publish-output-when-publishing-website-in-visual-studio/recent_banner.jpg" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">Visual Studio 發布網...</h3><div class="nk-post-meta-date">April 15, 2025</div></div><div class="nk-widget-post"><a href="/blog/pegasus-frontend-android-rom-meta-convert-from-skraper-generic-to-pegasus-metadata-missing-image-information/" class="nk-image-box-1 nk-post-image" title="使用Skraper取得的Metadata轉換成天馬前端後，遺失圖片資訊的解決方案"><img src="/blog/pegasus-frontend-android-rom-meta-convert-from-skraper-generic-to-pegasus-metadata-missing-image-information/recent_banner.png" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">使用Skraper取得的Metad...</h3><div class="nk-post-meta-date">March 19, 2025</div></div><div class="nk-widget-post"><a href="/blog/nlog-custom-target/" class="nk-image-box-1 nk-post-image" title="自訂義NLog 目標"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">自訂義NLog 目標</h3><div class="nk-post-meta-date">March 6, 2025</div></div><div class="nk-widget-post"><a href="/blog/net-framework-console-service-provider-template/" class="nk-image-box-1 nk-post-image" title=".Net Framework ServiceProvider 小筆記"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">.Net Framework Se...</h3><div class="nk-post-meta-date">March 5, 2025</div></div></div></div><div class="nk-widget"><h4 class="nk-widget-title">分類</h4><div><ul class="nk-widget-categories"><li><a href="/categories/Software/">Software</a></li><li><a href="/categories/Study-Circle/">Study Circle</a></li><li><a href="/categories/Information/">Information</a></li><li><a href="/categories/Trial-Games/">Trial Games</a></li><li><a href="/categories/Life/">生活記趣</a></li><li><a href="/categories/Game/">遊戲</a></li><li><a href="/categories/%E5%BF%83%E5%BE%97%E6%84%9F%E6%83%B3/">心得感想</a></li><li><a href="/categories/F2E/">F2E</a></li><li><a href="/categories/%E9%81%8A%E6%88%B2/">遊戲</a></li><li><a href="/categories/Note/">Note</a></li><li><a href="/categories/%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/">開發筆記</a></li></ul></div></div><div class="nk-widget"><h4 class="nk-widget-title">標籤</h4><div><div class="nk-widget-tags"><a class="tag-link" href="/tags/7-Zip/" rel="tag">7-Zip</a><a class="tag-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-link" href="/tags/Audio/" rel="tag">Audio</a><a class="tag-link" href="/tags/Bash/" rel="tag">Bash</a><a class="tag-link" href="/tags/Blender/" rel="tag">Blender</a><a class="tag-link" href="/tags/C/" rel="tag">C#</a><a class="tag-link" href="/tags/CSS/" rel="tag">CSS</a><a class="tag-link" href="/tags/Command/" rel="tag">Command</a><a class="tag-link" href="/tags/Excel/" rel="tag">Excel</a><a class="tag-link" href="/tags/Facebook/" rel="tag">Facebook</a><a class="tag-link" href="/tags/Funny/" rel="tag">Funny</a><a class="tag-link" href="/tags/GameDev/" rel="tag">GameDev</a><a class="tag-link" href="/tags/Github/" rel="tag">Github</a><a class="tag-link" href="/tags/Hexo/" rel="tag">Hexo</a><a class="tag-link" href="/tags/IIS/" rel="tag">IIS</a><a class="tag-link" href="/tags/JavaScript/" rel="tag">JavaScript</a><a class="tag-link" href="/tags/Linqpad/" rel="tag">Linqpad</a><a class="tag-link" href="/tags/Linux/" rel="tag">Linux</a><a class="tag-link" href="/tags/Mac-OS/" rel="tag">Mac OS</a><a class="tag-link" href="/tags/Microsoft-Office/" rel="tag">Microsoft Office</a><a class="tag-link" href="/tags/Music/" rel="tag">Music</a><a class="tag-link" href="/tags/NLog/" rel="tag">NLog</a><a class="tag-link" href="/tags/NPOI/" rel="tag">NPOI</a><a class="tag-link" href="/tags/Obsidian/" rel="tag">Obsidian</a><a class="tag-link" href="/tags/Pegasus/" rel="tag">Pegasus</a><a class="tag-link" href="/tags/Php/" rel="tag">Php</a><a class="tag-link" href="/tags/Refactoring/" rel="tag">Refactoring</a><a class="tag-link" href="/tags/SQLServer/" rel="tag">SQLServer</a><a class="tag-link" href="/tags/Skraper/" rel="tag">Skraper</a><a class="tag-link" href="/tags/Troubleshooting/" rel="tag">Troubleshooting</a><a class="tag-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><a class="tag-link" href="/tags/Unity/" rel="tag">Unity</a><a class="tag-link" href="/tags/VisualStudio/" rel="tag">VisualStudio</a><a class="tag-link" href="/tags/Windows/" rel="tag">Windows</a><a class="tag-link" href="/tags/Word/" rel="tag">Word</a><a class="tag-link" href="/tags/Wordpress/" rel="tag">Wordpress</a><a class="tag-link" href="/tags/dotnet/" rel="tag">dotnet</a><a class="tag-link" href="/tags/dotnet-core/" rel="tag">dotnet core</a><a class="tag-link" href="/tags/entityframework/" rel="tag">entityframework</a><a class="tag-link" href="/tags/npm/" rel="tag">npm</a><a class="tag-link" href="/tags/%E6%94%BB%E7%95%A5/" rel="tag">攻略</a><a class="tag-link" href="/tags/%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/" rel="tag">管理工具</a><a class="tag-link" href="/tags/%E8%A3%BD%E8%AD%9C/" rel="tag">製譜</a><a class="tag-link" href="/tags/%E9%9B%B2%E7%AB%AF%E6%9C%8D%E5%8B%99/" rel="tag">雲端服務</a></div></div></div><div class="nk-widget"><h4 class="nk-widget-title">相關文章</h4><div><div class="nk-widget-post"><a href="/blog/study-circle-blender-hard-surface-modeling/" class="nk-image-box-1 nk-post-image" title="Blender 學習筆記"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">Blender 學習筆記</h3><div class="nk-post-meta-date">November 21, 2024</div></div><div class="nk-widget-post"><a href="/blog/study-circle-javascript-design-pattern-part-1/" class="nk-image-box-1 nk-post-image" title="JavaScript設計樣式 Part 1"><img src="/blog/study-circle-javascript-design-pattern-part-1/recent_20230221.png" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">JavaScript設計樣式 Pa...</h3><div class="nk-post-meta-date">February 21, 2023</div></div><div class="nk-widget-post"><a href="/blog/study-circle-refactoring-appendix-extract-function/" class="nk-image-box-1 nk-post-image" title="重構心法之函式擷取術(Extract Function)"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">重構心法之函式擷取術(Extrac...</h3><div class="nk-post-meta-date">December 9, 2021</div></div><div class="nk-widget-post"><a href="/blog/study-circle-refactoring-appendix-slide-statements/" class="nk-image-box-1 nk-post-image" title="重構心法之陳述句滑動術(Slide Statements)"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">重構心法之陳述句滑動術(Slide...</h3><div class="nk-post-meta-date">December 15, 2021</div></div><div class="nk-widget-post"><a href="/blog/study-circle-refactoring-appendix-split-loop/" class="nk-image-box-1 nk-post-image" title="重構心法之迴圈切割術(Split Loop)"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">重構心法之迴圈切割術(Split ...</h3><div class="nk-post-meta-date">December 9, 2021</div></div><div class="nk-widget-post"><a href="/blog/study-circle-refactoring-part-1/" class="nk-image-box-1 nk-post-image" title="Refactoring 讀書心得 part 1"><img src="/blog/study-circle-refactoring-part-1/recent_refact2.jpg" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">Refactoring 讀書心得 ...</h3><div class="nk-post-meta-date">December 9, 2021</div></div><div class="nk-widget-post"><a href="/blog/study-circle-refactoring-part-2/" class="nk-image-box-1 nk-post-image" title="Refactoring 讀書心得 part 2"><img src="/blog/study-circle-refactoring-part-2/recent_refact2.jpg" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">Refactoring 讀書心得 ...</h3><div class="nk-post-meta-date">December 13, 2021</div></div><div class="nk-widget-post"><a href="/blog/javascript-array-sort-firstBy-thenBy/" class="nk-image-box-1 nk-post-image" title="JavaScript 陣列排序擴充套件推薦 - firstBy"><img src="/blog/javascript-array-sort-firstBy-thenBy/recent_banner.png" alt="img_banner" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">JavaScript 陣列排序擴充...</h3><div class="nk-post-meta-date">April 27, 2023</div></div><div class="nk-widget-post"><a href="/blog/jquery-validate-requiredif/" class="nk-image-box-1 nk-post-image" title="jquery-validate-requiredif"><img src="https://placehold.co/320x200.png?text=no+image" alt="No Image" class="nk-img-stretch"> &nbsp;</a><h3 class="nk-post-title">jquery-validate-r...</h3><div class="nk-post-meta-date">June 2, 2023</div></div></div></div><div class="nk-gap-4"></div></aside></div></div><div class="nk-gap-4"></div><div class="nk-gap-3"></div></div><footer class="nk-footer nk-footer-parallax nk-footer-parallax-opacity"><img class="nk-footer-top-corner" src="/assets/images/footer-corner.png" alt=""><div class="container"><div class="nk-gap"></div><p>2023 Antfire, All Rights Reserved.</p><div class="nk-footer-links"><a href="/terms" class="link-effect">服務條款</a> <span>|</span> <a href="/privacy" class="link-effect">隱私權政策</a> <span>|</span> <a target="_blank" rel="noopener" href="https://accessibility.moda.gov.tw/Applications/Detail?category=20230216154726" title="無障礙網站"><img src="/assets/images/%E7%B6%B2%E7%AB%99%E7%84%A1%E9%9A%9C%E7%A4%99%E6%A8%99%E7%AB%A0+A%E7%AD%89%E7%B4%9A%E5%9C%96%E7%A4%BA.png" border="0" width="88" height="31" alt="通過A無障礙網頁檢測"></a></div><div class="nk-gap-4"></div></div></footer></div><div class="nk-share-buttons nk-share-buttons-left d-none d-md-flex"><ul><li><a class="nk-share-icon text-white" title="Share page on Facebook" data-share="facebook" tabindex="12"><span class="icon fa fa-facebook"></span><br><h6 class="text-smaller" style="font-size:.3em">&nbsp;&nbsp; 開新視窗分享</h6></a><span class="nk-share-name">Facebook</span></li></ul></div><div class="nk-side-buttons nk-side-buttons-visible"><ul><li><a class="nk-btn nk-btn-lg nk-btn-icon nk-bg-audio-toggle" title="開啟／關閉聲音" tabindex="10"><span class="icon"><span class="ion-android-volume-up nk-bg-audio-pause-icon"></span> <span class="ion-android-volume-off nk-bg-audio-play-icon"></span></span></a></li><li class="nk-scroll-top"><a class="nk-btn nk-btn-lg nk-btn-icon" title="回到頂端" tabindex="11"><span class="icon ion-ios-arrow-up"></span></a></li></ul></div><div class="nk-search"><div class="container"><form action="/search/" method="GET"><fieldset class="form-group nk-search-field"><legend>&nbsp;</legend><input type="text" autocomplete="off" class="form-control" id="searchInput" placeholder="Search..." name="terms" title="search"> <label for="searchInput"><i class="ion-ios-search"></i></label></fieldset></form></div></div><script src="/assets/vendor/object-fit-images/dist/ofi.min.js"></script><script src="/assets/vendor/gsap/dist/gsap.min.js"></script><script src="/assets/vendor/gsap/dist/ScrollToPlugin.min.js"></script><script src="/assets/vendor/popper.js/dist/umd/popper.min.js"></script><script src="/assets/vendor/sticky-kit/dist/sticky-kit.min.js"></script><script src="/assets/vendor/jarallax/dist/jarallax.min.js"></script><script src="/assets/vendor/jarallax/dist/jarallax-video.min.js"></script><script src="/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script><script src="/assets/vendor/flickity/dist/flickity.pkgd.min.js"></script><script src="/assets/vendor/isotope-layout/dist/isotope.pkgd.min.js"></script><script src="/assets/vendor/photoswipe/dist/photoswipe.min.js"></script><script src="/assets/vendor/photoswipe/dist/photoswipe-ui-default.min.js"></script><script src="/assets/vendor/typed.js/lib/typed.min.js"></script><script src="/assets/vendor/jquery-validation/dist/jquery.validate.min.js"></script><script src="/assets/vendor/jquery-countdown/dist/jquery.countdown.min.js"></script><script src="/assets/vendor/moment/min/moment.min.js"></script><script src="/assets/vendor/moment-timezone/builds/moment-timezone-with-data.min.js"></script><script src="/assets/vendor/hammerjs/hammer.min.js"></script><script src="/assets/vendor/nanoscroller/bin/javascripts/jquery.nanoscroller.js"></script><script src="/assets/vendor/soundmanager2/script/soundmanager2-nodebug-jsmin.js"></script><script src="/assets/vendor/jquery-datetimepicker/build/jquery.datetimepicker.full.min.js"></script><script src="/assets/vendor/revolution/js/jquery.themepunch.tools.min.js"></script><script src="/assets/vendor/revolution/js/jquery.themepunch.revolution.min.js"></script><script src="/assets/vendor/revolution/js/extensions/revolution.extension.video.min.js"></script><script src="/assets/vendor/revolution/js/extensions/revolution.extension.carousel.min.js"></script><script src="/assets/vendor/revolution/js/extensions/revolution.extension.navigation.min.js"></script><script src="/assets/vendor/keymaster/keymaster.js"></script><script src="/assets/vendor/summernote/dist/summernote-bs4.min.js"></script><script src="/assets/vendor/js-dos/dist/js-dos.js"></script><script src="/assets/js/godlike.min.js"></script><script src="/assets/js/godlike-init.js"></script><script type="text/javascript">var revapi50,tpj=jQuery;tpj(document).ready(function(){null==tpj("#rev_slider_50_1").revolution?revslider_showDoubleJqueryError("#rev_slider_50_1"):revapi50=tpj("#rev_slider_50_1").show().revolution({sliderType:"carousel",jsFileLocation:"/assets/vendor/revolution/js/",sliderLayout:"auto",dottedOverlay:"none",delay:9e3,navigation:{keyboardNavigation:"off",keyboard_direction:"horizontal",onHoverStop:"off"},carousel:{maxRotation:8,vary_rotation:"off",minScale:20,vary_scale:"off",horizontal_align:"center",vertical_align:"center",fadeout:"off",vary_fade:"off",maxVisibleItems:3,infinity:"on",space:-90,stretch:"off"},responsiveLevels:[1240,1024,778,480],gridwidth:[800,600,400,320],gridheight:[600,400,320,280],lazyType:"none",shadow:0,spinner:"off",stopLoop:"on",stopAfterLoops:0,stopAtSlide:0,shuffle:"off",autoHeight:"off",fullScreenAlignForce:"off",fullScreenOffsetContainer:"",fullScreenOffset:"",disableProgressBar:"on",hideThumbsOnMobile:"off",hideSliderAtLimit:0,hideCaptionAtLimit:0,hideAllCaptionAtLilmit:0,debugMode:!1,fallbacks:{simplifyAll:"off",nextSlideOnWindowFocus:"off",disableFocusListener:!1}})})</script><script>window.fbAsyncInit=function(){FB.init({appId:"545543353411406",autoLogAppEvents:!0,xfbml:!0,version:"v12.0"})}</script><script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1357771911059149" crossorigin="anonymous"></script></body></html>